<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>V2Ray 搭建教程 | 幸运小站</title><meta name=keywords content="v2ray,翻墙"><meta name=description content="自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 V2Ray 官方网站以及白话文教程。"><meta name=author content="awsl"><link rel=canonical href=https://cyh.me/posts/v2ray/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://cyh.me/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://cyh.me/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://cyh.me/favicon-32x32.png><link rel=apple-touch-icon href=https://cyh.me/apple-touch-icon.png><link rel=mask-icon href=https://cyh.me/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><meta property="og:title" content="V2Ray 搭建教程"><meta property="og:description" content="自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 V2Ray 官方网站以及白话文教程。"><meta property="og:type" content="article"><meta property="og:url" content="https://cyh.me/posts/v2ray/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-06-30T00:00:00+00:00"><meta property="article:modified_time" content="2019-06-30T00:00:00+00:00"><meta property="og:site_name" content="幸运小站"><meta name=twitter:card content="summary"><meta name=twitter:title content="V2Ray 搭建教程"><meta name=twitter:description content="自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 V2Ray 官方网站以及白话文教程。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://cyh.me/posts/"},{"@type":"ListItem","position":2,"name":"V2Ray 搭建教程","item":"https://cyh.me/posts/v2ray/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"V2Ray 搭建教程","name":"V2Ray 搭建教程","description":"自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 V2Ray 官方网站以及白话文教程。\n","keywords":["v2ray","翻墙"],"articleBody":"自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 V2Ray 官方网站以及白话文教程。\n[toc]\n0 开篇 初识 V2Ray，很可能对它复杂的配置方式感到望而却步，但实际上大部分工作我们并不需要去做，大部分工作已经整合进 V2Ray 中或已有现成的脚本可以实现，大家大可不必担心自己会因专业知识不足而止步。\n如果仅图个方便，那么只看前两部分就已经足够；如果希望翻墙的过程更安全（喜欢折腾），则可以参考之后的内容。\n1 准备工作及服务器安装 V2Ray 1.1 校准时间 V2Ray 的使用最最最重要的一点是时间校准，一般要求服务器时间与本地时间相差不得超过 90 秒，否则可能出现验证失败的状况，因此我们第一步就是校准时间。\nLinux 系统下使用 date -R 命令查看当前系统日期：\n1 2 $ date -R Sun, 30 Jun 2020 06:51:53 +0000 这里的 +0000 代表格林尼治时间，需要调换成自己设备对应的时区，调整方式如下：\n1 2 3 4 5 6 $ dpkg-reconfigure tzdata // 选择时区 Current default time zone: 'Asia/Shanghai' Local time is now: Mon Mar 9 12:27:47 CST 2020. Universal Time is now: Mon Mar 9 04:27:47 UTC 2020. 1.2 安装 V2Ray 先安装必要的依赖：\n1 2 3 $ apt update $ apt upgrade $ apt install curl zip 直接运行官方脚本：\n1 2 3 4 5 6 7 8 $ bash \u003c(curl -L -s https://install.direct/go.sh) ... PORT:18362 UUID:5575a0ff-f9d4-4903-8b64-b49981e8cae0 ... 这样 V2Ray 的基本安装就已经完成了，记住这里的 PORT 及 UUID 信息，最后启动V2Ray：\n1 $ systemctl start v2ray.service 1.3 修改 V2Ray 配置 配置文件在 /etc/v2ray/config.json，以下为简单的配置模板：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 { \"inbounds\": [ { \"port\": 18362, // 服务器监听端口 \"protocol\": \"vmess\", // 主传入协议 \"settings\": { \"clients\": [ { \"id\": \"5575a0ff-f9d4-4903-8b64-b49981e8cae0\", // 用户 ID，客户端与服务器必须相同 \"alterId\": 64 } ] } } ], \"outbounds\": [ { \"protocol\": \"freedom\", // 主传出协议 \"settings\": {} } ] } 注：其中 UUID 可以在 UUID 生成器中获取，或者输入 uuidgen 生成。\n1 2 $ uuidgen 5575a0ff-f9d4-4903-8b64-b49981e8cae0 最后记得重新启动 V2Ray 让配置生效：\n1 $ systemctl restart v2ray.service 2 客户端配置 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 { \"inbounds\": [ { \"port\": 10808, // 填写本地端口 \"protocol\": \"socks\", \"sniffing\": { \"enabled\": true, \"destOverride\": [\"http\", \"tls\"] }, \"settings\": { \"auth\": \"noauth\" } } ], \"outbounds\": [ { \"protocol\": \"vmess\", \"settings\": { \"vnext\": [ { \"address\": \"{ip_address}\", \"port\": 18362, // 必须与服务器端配置相同 \"users\": [ { \"id\": \"5575a0ff-f9d4-4903-8b64-b49981e8cae0\", // 必须与服务器端配置相同 \"alterId\": 64 // 必须与服务器端配置相同 } ] } ] } } ] } 3 V2Ray 进阶 这一节的内容可能会稍稍有一些繁琐，如若希望减少服务器被墙几率而且时间充裕则可以尝试尝试。\n3.1 TLS TLS 中文译名是传输层安全，可以使用户与服务器之间的通信不被窃听，详细内容可自行查询。\n为了使用 TLS，可以去 Freenom 申请一个免费域名。然后设置将其解析到服务器，这里选择使用 Cloudflare 进行解析，但不要开启 CDN。\n以下内容假设注册的域名为 example.com。\n3.1.1 安装证书 使用 TLS 还需要安装证书，选择免费证书 Let's Encrypt 即可，通过 certbot 脚本安装：\n1 $ apt install certbot 然后开始安装，如果希望收到证书到期提醒邮件，可以删去 --register-unsafely-without-email：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 $ certbot certonly --register-unsafely-without-email Saving debug log to /var/log/letsencrypt/letsencrypt.log How would you like to authenticate with the ACME CA? - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 1: Spin up a temporary webserver (standalone) 2: Place files in webroot directory (webroot) - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 1 Plugins selected: Authenticator standalone, Installer None Registering without email! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Please read the Terms of Service at https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must agree in order to register with the ACME server at https://acme-v02.api.letsencrypt.org/directory - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - (A)gree/(C)ancel: A Please enter in your domain name(s) (comma and/or space separated) (Enter 'c' to cancel): example.com ... - Congratulations! Your certificate and chain have been saved at: /etc/letsencrypt/live/example.com/fullchain.pem Your key file has been saved at: /etc/letsencrypt/live/example.com/privkey.pem ... 注意证书和密钥的安装位置：\n证书：/etc/letsencrypt/live/example.com/fullchain.pem 密钥：/etc/letsencrypt/live/example.com/privkey.pem 3.1.2 修改 V2Ray 配置 服务器端配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 { \"inbounds\": [ { \"port\": 443, // 建议使用 443 端口 \"protocol\": \"vmess\", \"settings\": { \"clients\": [ { \"id\": \"5575a0ff-f9d4-4903-8b64-b49981e8cae0\", \"alterId\": 64 } ] }, \"streamSettings\": { \"network\": \"tcp\", \"security\": \"tls\", // security 要设置为 tls 才会启用 TLS \"tlsSettings\": { \"certificates\": [ { \"certificateFile\": \"/etc/letsencrypt/live/example.com/fullchain.pem\", // 证书地址 \"keyFile\": \"/etc/letsencrypt/live/example.com/privkey.pem\" // 密钥地址 } ] } } } ], \"outbounds\": [ { \"protocol\": \"freedom\", \"settings\": {} } ] } 客户端配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 { \"inbounds\": [ { \"port\": 10808, \"protocol\": \"socks\", \"sniffing\": { \"enabled\": true, \"destOverride\": [\"http\", \"tls\"] }, \"settings\": { \"auth\": \"noauth\" } } ], \"outbounds\": [ { \"protocol\": \"vmess\", \"settings\": { \"vnext\": [ { \"address\": \"example.com\", // 填写域名 \"port\": 443, \"users\": [ { \"id\": \"5575a0ff-f9d4-4903-8b64-b49981e8cae0\", \"alterId\": 64 } ] } ] }, \"streamSettings\": { \"network\": \"tcp\", \"security\": \"tls\" // 客户端的 security 也要设置为 tls } } ] } 3.2 TLS + Websocket + Web 在上一节的基础上，我们使用真正的网站请求，这样从外部看我们是在正常访问一个网站，而实际上请求的内容在服务器内部进行转发，再通过服务器去获得我们需要的内容，然后返回客户端。这是目前最为安全且稳定的使用方式。\n3.2.1 Nginx 配置 安装 Nginx，并新建一个 Nginx 配置文件，注意以 .conf 结尾：\n1 2 $ apt install nginx $ vim /etc/nginx/conf.d/example.com.conf 写入以下配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 server { server_name example.com; # 改成注册的域名 listen 80; location /v2ray { # 可随意设置location路径，待会需要用到 proxy_redirect off; proxy_pass http://127.0.0.1:18362; # 记住端口号 proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host $http_host; } } 3.2.2 安装证书 安装 certbot 和它的 Nginx 插件：\n1 $ apt install certbot python3-certbot-nginx 安装证书，如果希望收到证书到期提醒邮件，可以删去 --register-unsafely-without-email：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 $ certbot --nginx --register-unsafely-without-email Saving debug log to /var/log/letsencrypt/letsencrypt.log Plugins selected: Authenticator nginx, Installer nginx Registering without email! - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Please read the Terms of Service at https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must agree in order to register with the ACME server at https://acme-v02.api.letsencrypt.org/directory - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - (A)gree/(C)ancel: A Which names would you like to activate HTTPS for? - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 1: example.com - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Select the appropriate numbers separated by commas and/or spaces, or leave input blank to select all options shown (Enter 'c' to cancel): 1 ... Deploying Certificate to VirtualHost /etc/nginx/conf.d/example.com.conf Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access. - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 1: No redirect - Make no further changes to the webserver configuration. 2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for new sites, or if you're confident your site works on HTTPS. You can undo this change by editing your web server's configuration. - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Select the appropriate number [1-2] then [enter] (press 'c' to cancel): 2 Redirecting all traffic on port 80 to ssl in /etc/nginx/conf.d/example.com.conf - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - Congratulations! You have successfully enabled https://example.com ... 此时再查看 Nginx 的配置文件会发现发生了一些变化：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 server { server_name example.com; location /v2ray { proxy_redirect off; proxy_pass http://127.0.0.1:18362; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host $http_host; } listen 443 ssl; # managed by Certbot ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem; # managed by Certbot ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem; # managed by Certbot include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot } server { if ($host = example.com) { return 301 https://$host$request_uri; } # managed by Certbot server_name example.com; listen 80; return 404; # managed by Certbot } 这时 Nginx 和证书的配置就完成了，接下来修改 V2Ray 的配置\n3.2.2 修改 V2Ray 配置 服务器端配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 { \"inbounds\": [ { \"port\": 18362, // 与上一小节的端口号一致 \"listen\":\"127.0.0.1\", \"protocol\": \"vmess\", \"settings\": { \"clients\": [ { \"id\": \"5575a0ff-f9d4-4903-8b64-b49981e8cae0\", // 请自行修改 \"alterId\": 64 } ] }, \"streamSettings\": { \"network\": \"ws\", \"wsSettings\": { \"path\": \"/v2ray\" // 与上一小节的路径一致 } } } ], \"outbounds\": [ { \"protocol\": \"freedom\", \"settings\": {} } ] } 客户端配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 { \"inbounds\": [ { \"port\": 10808, \"listen\": \"127.0.0.1\", \"protocol\": \"socks\", \"sniffing\": { \"enabled\": true, \"destOverride\": [\"http\", \"tls\"] }, \"settings\": { \"auth\": \"noauth\", \"udp\": false } } ], \"outbounds\": [ { \"protocol\": \"vmess\", \"settings\": { \"vnext\": [ { \"address\": \"example.com\", \"port\": 443, \"users\": [ { \"id\": \"5575a0ff-f9d4-4903-8b64-b49981e8cae0\", \"alterId\": 64 } ] } ] }, \"streamSettings\": { \"network\": \"ws\", \"security\": \"tls\", \"wsSettings\": { \"path\": \"/v2ray\" } } } ] } ","wordCount":"2987","inLanguage":"zh","datePublished":"2019-06-30T00:00:00Z","dateModified":"2019-06-30T00:00:00Z","author":{"@type":"Person","name":"awsl"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://cyh.me/posts/v2ray/"},"publisher":{"@type":"Organization","name":"幸运小站","logo":{"@type":"ImageObject","url":"https://cyh.me/favicon.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://cyh.me/ accesskey=h title="幸运小站 (Alt + H)"><img src=https://cyh.me/favicon.png alt=logo aria-label=logo height=25>幸运小站</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://cyh.me/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://cyh.me/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://cyh.me/ title=Home><span>Home</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>V2Ray 搭建教程</h1><div class=post-meta><span title='2019-06-30 00:00:00 +0000 UTC'>2019-06-30</span>&nbsp;·&nbsp;6 分钟&nbsp;·&nbsp;2987 字&nbsp;·&nbsp;awsl</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#0-%e5%bc%80%e7%af%87 aria-label="0 开篇">0 开篇</a></li><li><a href=#1-%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c%e5%8f%8a%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%ae%89%e8%a3%85-v2ray aria-label="1 准备工作及服务器安装 V2Ray">1 准备工作及服务器安装 V2Ray</a><ul><li><a href=#11-%e6%a0%a1%e5%87%86%e6%97%b6%e9%97%b4 aria-label="1.1 校准时间"><strong>1.1 校准时间</strong></a></li><li><a href=#12-%e5%ae%89%e8%a3%85-v2ray aria-label="1.2 安装 V2Ray">1.2 安装 V2Ray</a></li><li><a href=#13-%e4%bf%ae%e6%94%b9-v2ray-%e9%85%8d%e7%bd%ae aria-label="1.3 修改 V2Ray 配置">1.3 修改 V2Ray 配置</a></li></ul></li><li><a href=#2-%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae aria-label="2 客户端配置">2 客户端配置</a></li><li><a href=#3-v2ray-%e8%bf%9b%e9%98%b6 aria-label="3 V2Ray 进阶">3 V2Ray 进阶</a><ul><li><a href=#31-tls aria-label="3.1 TLS">3.1 TLS</a><ul><li><a href=#311-%e5%ae%89%e8%a3%85%e8%af%81%e4%b9%a6 aria-label="3.1.1 安装证书">3.1.1 安装证书</a></li><li><a href=#312-%e4%bf%ae%e6%94%b9-v2ray-%e9%85%8d%e7%bd%ae aria-label="3.1.2 修改 V2Ray 配置">3.1.2 修改 V2Ray 配置</a></li></ul></li><li><a href=#32-tls--websocket--web aria-label="3.2 TLS + Websocket + Web">3.2 TLS + Websocket + Web</a><ul><li><a href=#321-nginx-%e9%85%8d%e7%bd%ae aria-label="3.2.1 Nginx 配置">3.2.1 Nginx 配置</a></li><li><a href=#322-%e5%ae%89%e8%a3%85%e8%af%81%e4%b9%a6 aria-label="3.2.2 安装证书">3.2.2 安装证书</a></li><li><a href=#322-%e4%bf%ae%e6%94%b9-v2ray-%e9%85%8d%e7%bd%ae aria-label="3.2.2 修改 V2Ray 配置">3.2.2 修改 V2Ray 配置</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 <a href=https://v2ray.com/>V2Ray 官方网站</a>以及<a href=https://toutyrater.github.io/>白话文教程</a>。</p><p>[toc]</p><h2 id=0-开篇>0 开篇<a hidden class=anchor aria-hidden=true href=#0-开篇>#</a></h2><p>初识 V2Ray，很可能对它复杂的配置方式感到望而却步，但实际上大部分工作我们并不需要去做，大部分工作已经整合进 V2Ray 中或已有现成的脚本可以实现，大家大可不必担心自己会因专业知识不足而止步。</p><p>如果仅图个方便，那么只看前两部分就已经足够；如果希望翻墙的过程更安全（喜欢折腾），则可以参考之后的内容。</p><h2 id=1-准备工作及服务器安装-v2ray>1 准备工作及服务器安装 V2Ray<a hidden class=anchor aria-hidden=true href=#1-准备工作及服务器安装-v2ray>#</a></h2><h3 id=11-校准时间><strong>1.1 校准时间</strong><a hidden class=anchor aria-hidden=true href=#11-校准时间>#</a></h3><p>V2Ray 的使用最最最重要的一点是时间校准，一般要求服务器时间与本地时间相差不得超过 90 秒，否则可能出现验证失败的状况，因此我们第一步就是校准时间。</p><p>Linux 系统下使用 <code>date -R</code> 命令查看当前系统日期：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ date -R
</span></span><span class=line><span class=cl>Sun, <span class=m>30</span> Jun <span class=m>2020</span> 06:51:53 +0000
</span></span></code></pre></td></tr></table></div></div><p>这里的 <code>+0000</code> 代表格林尼治时间，需要调换成自己设备对应的时区，调整方式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ dpkg-reconfigure tzdata 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// 选择时区
</span></span><span class=line><span class=cl>Current default <span class=nb>time</span> zone: <span class=s1>&#39;Asia/Shanghai&#39;</span>
</span></span><span class=line><span class=cl>Local <span class=nb>time</span> is now:      Mon Mar  <span class=m>9</span> 12:27:47 CST 2020.
</span></span><span class=line><span class=cl>Universal Time is now:  Mon Mar  <span class=m>9</span> 04:27:47 UTC 2020.
</span></span></code></pre></td></tr></table></div></div><h3 id=12-安装-v2ray>1.2 安装 V2Ray<a hidden class=anchor aria-hidden=true href=#12-安装-v2ray>#</a></h3><p>先安装必要的依赖：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ apt update
</span></span><span class=line><span class=cl>$ apt upgrade
</span></span><span class=line><span class=cl>$ apt install curl zip
</span></span></code></pre></td></tr></table></div></div><p>直接运行官方脚本：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ bash &lt;<span class=o>(</span>curl -L -s https://install.direct/go.sh<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT:18362
</span></span><span class=line><span class=cl>UUID:5575a0ff-f9d4-4903-8b64-b49981e8cae0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>这样 V2Ray 的基本安装就已经完成了，记住这里的 PORT 及 UUID 信息，最后启动V2Ray：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ systemctl start v2ray.service
</span></span></code></pre></td></tr></table></div></div><h3 id=13-修改-v2ray-配置>1.3 修改 V2Ray 配置<a hidden class=anchor aria-hidden=true href=#13-修改-v2ray-配置>#</a></h3><p>配置文件在 <code>/etc/v2ray/config.json</code>，以下为简单的配置模板：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>18362</span><span class=p>,</span>  <span class=c1>// 服务器监听端口
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>  <span class=c1>// 主传入协议
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;clients&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5575a0ff-f9d4-4903-8b64-b49981e8cae0&#34;</span><span class=p>,</span>  <span class=c1>// 用户 ID，客户端与服务器必须相同
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;freedom&#34;</span><span class=p>,</span>  <span class=c1>// 主传出协议
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>注：其中 UUID 可以在 <a href=https://www.uuidgenerator.net/>UUID 生成器</a>中获取，或者输入 <code>uuidgen</code> 生成。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ uuidgen
</span></span><span class=line><span class=cl>5575a0ff-f9d4-4903-8b64-b49981e8cae0
</span></span></code></pre></td></tr></table></div></div><p>最后记得重新启动 V2Ray 让配置生效：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ systemctl restart v2ray.service
</span></span></code></pre></td></tr></table></div></div><h2 id=2-客户端配置>2 客户端配置<a hidden class=anchor aria-hidden=true href=#2-客户端配置>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>10808</span><span class=p>,</span>  <span class=c1>// 填写本地端口
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;socks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sniffing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;enabled&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;destOverride&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;http&#34;</span><span class=p>,</span> <span class=s2>&#34;tls&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=s2>&#34;noauth&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;vnext&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;{ip_address}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>18362</span><span class=p>,</span>  <span class=c1>// 必须与服务器端配置相同
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5575a0ff-f9d4-4903-8b64-b49981e8cae0&#34;</span><span class=p>,</span>  <span class=c1>// 必须与服务器端配置相同
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>64</span>  <span class=c1>// 必须与服务器端配置相同
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=3-v2ray-进阶>3 V2Ray 进阶<a hidden class=anchor aria-hidden=true href=#3-v2ray-进阶>#</a></h2><p>这一节的内容可能会稍稍有一些繁琐，如若希望减少服务器被墙几率而且时间充裕则可以尝试尝试。</p><h3 id=31-tls>3.1 TLS<a hidden class=anchor aria-hidden=true href=#31-tls>#</a></h3><p>TLS 中文译名是传输层安全，可以使用户与服务器之间的通信不被窃听，详细内容可自行查询。</p><p>为了使用 TLS，可以去 <a href=https://www.freenom.com/>Freenom</a> 申请一个免费域名。然后设置将其解析到服务器，这里选择<a href=/2019/04/wordpress-website/#toc-7>使用 Cloudflare 进行解析</a>，但<strong>不要开启 CDN</strong>。</p><p>以下内容假设注册的域名为 example.com。</p><h4 id=311-安装证书>3.1.1 安装证书<a hidden class=anchor aria-hidden=true href=#311-安装证书>#</a></h4><p>使用 TLS 还需要安装证书，选择免费证书 <a href=https://letsencrypt.org/>Let's Encrypt</a> 即可，通过 certbot 脚本安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ apt install certbot
</span></span></code></pre></td></tr></table></div></div><p>然后开始安装，如果希望收到证书到期提醒邮件，可以删去 <code>--register-unsafely-without-email</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ certbot certonly --register-unsafely-without-email
</span></span><span class=line><span class=cl>Saving debug log to /var/log/letsencrypt/letsencrypt.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>How would you like to authenticate with the ACME CA?
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>1: Spin up a temporary webserver <span class=o>(</span>standalone<span class=o>)</span>
</span></span><span class=line><span class=cl>2: Place files in webroot directory <span class=o>(</span>webroot<span class=o>)</span>
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>Select the appropriate number <span class=o>[</span>1-2<span class=o>]</span> <span class=k>then</span> <span class=o>[</span>enter<span class=o>]</span> <span class=o>(</span>press <span class=s1>&#39;c&#39;</span> to cancel<span class=o>)</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl>Plugins selected: Authenticator standalone, Installer None
</span></span><span class=line><span class=cl>Registering without email!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>Please <span class=nb>read</span> the Terms of Service at
</span></span><span class=line><span class=cl>https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must
</span></span><span class=line><span class=cl>agree in order to register with the ACME server at
</span></span><span class=line><span class=cl>https://acme-v02.api.letsencrypt.org/directory
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl><span class=o>(</span>A<span class=o>)</span>gree/<span class=o>(</span>C<span class=o>)</span>ancel: A
</span></span><span class=line><span class=cl>Please enter in your domain name<span class=o>(</span>s<span class=o>)</span> <span class=o>(</span>comma and/or space separated<span class=o>)</span>  <span class=o>(</span>Enter <span class=s1>&#39;c&#39;</span>
</span></span><span class=line><span class=cl>to cancel<span class=o>)</span>: example.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> - Congratulations! Your certificate and chain have been saved at:
</span></span><span class=line><span class=cl>   /etc/letsencrypt/live/example.com/fullchain.pem
</span></span><span class=line><span class=cl>   Your key file has been saved at:
</span></span><span class=line><span class=cl>   /etc/letsencrypt/live/example.com/privkey.pem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>注意证书和密钥的安装位置：</p><ul><li>证书：<code>/etc/letsencrypt/live/example.com/fullchain.pem</code></li><li>密钥：<code>/etc/letsencrypt/live/example.com/privkey.pem</code></li></ul><h4 id=312-修改-v2ray-配置>3.1.2 修改 V2Ray 配置<a hidden class=anchor aria-hidden=true href=#312-修改-v2ray-配置>#</a></h4><p>服务器端配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>443</span><span class=p>,</span>  <span class=c1>// 建议使用 443 端口
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>    
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;clients&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5575a0ff-f9d4-4903-8b64-b49981e8cae0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;streamSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;network&#34;</span><span class=p>:</span> <span class=s2>&#34;tcp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;tls&#34;</span><span class=p>,</span>  <span class=c1>// security 要设置为 tls 才会启用 TLS
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nt>&#34;tlsSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;certificates&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nt>&#34;certificateFile&#34;</span><span class=p>:</span> <span class=s2>&#34;/etc/letsencrypt/live/example.com/fullchain.pem&#34;</span><span class=p>,</span>  <span class=c1>// 证书地址
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=nt>&#34;keyFile&#34;</span><span class=p>:</span> <span class=s2>&#34;/etc/letsencrypt/live/example.com/privkey.pem&#34;</span>  <span class=c1>// 密钥地址
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;freedom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>客户端配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>10808</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;socks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sniffing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;enabled&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;destOverride&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;http&#34;</span><span class=p>,</span> <span class=s2>&#34;tls&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=s2>&#34;noauth&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;vnext&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;example.com&#34;</span><span class=p>,</span>  <span class=c1>// 填写域名
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>443</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5575a0ff-f9d4-4903-8b64-b49981e8cae0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;streamSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;network&#34;</span><span class=p>:</span> <span class=s2>&#34;tcp&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;tls&#34;</span>  <span class=c1>// 客户端的 security 也要设置为 tls
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=32-tls--websocket--web>3.2 TLS + Websocket + Web<a hidden class=anchor aria-hidden=true href=#32-tls--websocket--web>#</a></h3><p>在上一节的基础上，我们使用真正的网站请求，这样从外部看我们是在正常访问一个网站，而实际上请求的内容在服务器内部进行转发，再通过服务器去获得我们需要的内容，然后返回客户端。这是目前最为安全且稳定的使用方式。</p><h4 id=321-nginx-配置>3.2.1 Nginx 配置<a hidden class=anchor aria-hidden=true href=#321-nginx-配置>#</a></h4><p>安装 Nginx，并新建一个 Nginx 配置文件，<strong>注意以 .conf 结尾</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ apt install nginx
</span></span><span class=line><span class=cl>$ vim /etc/nginx/conf.d/example.com.conf
</span></span></code></pre></td></tr></table></div></div><p>写入以下配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>             <span class=s>example.com</span><span class=p>;</span>  <span class=c1># 改成注册的域名
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>listen</span>                  <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/v2ray</span> <span class=p>{</span>  <span class=c1># 可随意设置location路径，待会需要用到
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>proxy_redirect</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:18362</span><span class=p>;</span>  <span class=c1># 记住端口号
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	    <span class=kn>proxy_set_header</span> <span class=s>Upgrade</span> <span class=nv>$http_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#34;upgrade&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$http_host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=322-安装证书>3.2.2 安装证书<a hidden class=anchor aria-hidden=true href=#322-安装证书>#</a></h4><p>安装 certbot 和它的 Nginx 插件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ apt install certbot python3-certbot-nginx
</span></span></code></pre></td></tr></table></div></div><p>安装证书，如果希望收到证书到期提醒邮件，可以删去 <code>--register-unsafely-without-email</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ certbot --nginx --register-unsafely-without-email
</span></span><span class=line><span class=cl>Saving debug log to /var/log/letsencrypt/letsencrypt.log
</span></span><span class=line><span class=cl>Plugins selected: Authenticator nginx, Installer nginx
</span></span><span class=line><span class=cl>Registering without email!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>Please <span class=nb>read</span> the Terms of Service at
</span></span><span class=line><span class=cl>https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must
</span></span><span class=line><span class=cl>agree in order to register with the ACME server at
</span></span><span class=line><span class=cl>https://acme-v02.api.letsencrypt.org/directory
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl><span class=o>(</span>A<span class=o>)</span>gree/<span class=o>(</span>C<span class=o>)</span>ancel: A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Which names would you like to activate HTTPS <span class=k>for</span>?
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>1: example.com
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>Select the appropriate numbers separated by commas and/or spaces, or leave input
</span></span><span class=line><span class=cl>blank to <span class=k>select</span> all options shown <span class=o>(</span>Enter <span class=s1>&#39;c&#39;</span> to cancel<span class=o>)</span>: <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Deploying Certificate to VirtualHost /etc/nginx/conf.d/example.com.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>1: No redirect - Make no further changes to the webserver configuration.
</span></span><span class=line><span class=cl>2: Redirect - Make all requests redirect to secure HTTPS access. Choose this <span class=k>for</span>
</span></span><span class=line><span class=cl>new sites, or <span class=k>if</span> you<span class=s1>&#39;re confident your site works on HTTPS. You can undo this
</span></span></span><span class=line><span class=cl><span class=s1>change by editing your web server&#39;</span>s configuration.
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>Select the appropriate number <span class=o>[</span>1-2<span class=o>]</span> <span class=k>then</span> <span class=o>[</span>enter<span class=o>]</span> <span class=o>(</span>press <span class=s1>&#39;c&#39;</span> to cancel<span class=o>)</span>: <span class=m>2</span>
</span></span><span class=line><span class=cl>Redirecting all traffic on port <span class=m>80</span> to ssl in /etc/nginx/conf.d/example.com.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
</span></span><span class=line><span class=cl>Congratulations! You have successfully enabled https://example.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>此时再查看 Nginx 的配置文件会发现发生了一些变化：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>             <span class=s>example.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/v2ray</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_redirect</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:18362</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Upgrade</span> <span class=nv>$http_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#34;upgrade&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$http_host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ssl_certificate</span> <span class=s>/etc/letsencrypt/live/example.com/fullchain.pem</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ssl_certificate_key</span> <span class=s>/etc/letsencrypt/live/example.com/privkey.pem</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>include</span> <span class=s>/etc/letsencrypt/options-ssl-nginx.conf</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ssl_dhparam</span> <span class=s>/etc/letsencrypt/ssl-dhparams.pem</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>if</span> <span class=s>(</span><span class=nv>$host</span> <span class=p>=</span> <span class=s>example.com)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>             <span class=s>example.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>                  <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>404</span><span class=p>;</span> <span class=c1># managed by Certbot
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这时 Nginx 和证书的配置就完成了，接下来修改 V2Ray 的配置</p><h4 id=322-修改-v2ray-配置>3.2.2 修改 V2Ray 配置<a hidden class=anchor aria-hidden=true href=#322-修改-v2ray-配置>#</a></h4><p>服务器端配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>18362</span><span class=p>,</span>  <span class=c1>// 与上一小节的端口号一致
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nt>&#34;listen&#34;</span><span class=p>:</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;clients&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5575a0ff-f9d4-4903-8b64-b49981e8cae0&#34;</span><span class=p>,</span>  <span class=c1>// 请自行修改
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;streamSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;network&#34;</span><span class=p>:</span> <span class=s2>&#34;ws&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;wsSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/v2ray&#34;</span>  <span class=c1>// 与上一小节的路径一致
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;freedom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>客户端配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;inbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>10808</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;listen&#34;</span><span class=p>:</span> <span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;socks&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sniffing&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;enabled&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;destOverride&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;http&#34;</span><span class=p>,</span> <span class=s2>&#34;tls&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=s2>&#34;noauth&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;udp&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;outbounds&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;protocol&#34;</span><span class=p>:</span> <span class=s2>&#34;vmess&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;settings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;vnext&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;address&#34;</span><span class=p>:</span> <span class=s2>&#34;example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>443</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;users&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>              <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5575a0ff-f9d4-4903-8b64-b49981e8cae0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nt>&#34;alterId&#34;</span><span class=p>:</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;streamSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;network&#34;</span><span class=p>:</span> <span class=s2>&#34;ws&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;security&#34;</span><span class=p>:</span> <span class=s2>&#34;tls&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;wsSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/v2ray&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://cyh.me/tags/v2ray/>V2Ray</a></li><li><a href=https://cyh.me/tags/%E6%90%AD%E5%BB%BA/>搭建</a></li></ul><nav class=paginav><a class=prev href=https://cyh.me/posts/windows-activate/><span class=title>« 上一页</span><br><span>激活 Windows 10</span></a>
<a class=next href=https://cyh.me/posts/wordpress-forget-password/><span class=title>下一页 »</span><br><span>忘记 WordPress 密码怎么办？</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://cyh.me/>幸运小站</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M336 64h-53.88C268.9 26.8 233.7 0 192 0S115.1 26.8 101.9 64H48C21.5 64 0 85.48 0 112v352C0 490.5 21.5 512 48 512h288c26.5 0 48-21.48 48-48v-352C384 85.48 362.5 64 336 64zM192 64c17.67 0 32 14.33 32 32c0 17.67-14.33 32-32 32S160 113.7 160 96C160 78.33 174.3 64 192 64zM272 224h-160C103.2 224 96 216.8 96 208C96 199.2 103.2 192 112 192h160C280.8 192 288 199.2 288 208S280.8 224 272 224z"/></svg>';function s(){t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M336 64h-53.88C268.9 26.8 233.7 0 192 0S115.1 26.8 101.9 64H48C21.5 64 0 85.48 0 112v352C0 490.5 21.5 512 48 512h288c26.5 0 48-21.48 48-48v-352C384 85.48 362.5 64 336 64zM192 64c17.67 0 32 14.33 32 32s-14.33 32-32 32S160 113.7 160 96S174.3 64 192 64zM282.9 262.8l-88 112c-4.047 5.156-10.02 8.438-16.53 9.062C177.6 383.1 176.8 384 176 384c-5.703 0-11.25-2.031-15.62-5.781l-56-48c-10.06-8.625-11.22-23.78-2.594-33.84c8.609-10.06 23.77-11.22 33.84-2.594l36.98 31.69l72.52-92.28c8.188-10.44 23.3-12.22 33.7-4.062C289.3 237.3 291.1 252.4 282.9 262.8z"/></svg>',setTimeout(()=>{t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M336 64h-53.88C268.9 26.8 233.7 0 192 0S115.1 26.8 101.9 64H48C21.5 64 0 85.48 0 112v352C0 490.5 21.5 512 48 512h288c26.5 0 48-21.48 48-48v-352C384 85.48 362.5 64 336 64zM192 64c17.67 0 32 14.33 32 32c0 17.67-14.33 32-32 32S160 113.7 160 96C160 78.33 174.3 64 192 64zM272 224h-160C103.2 224 96 216.8 96 208C96 199.2 103.2 192 112 192h160C280.8 192 288 199.2 288 208S280.8 224 272 224z"/></svg>'},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>