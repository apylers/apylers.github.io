<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.73.0 with theme Tranquilpeak 0.4.7-BETA"><meta name=author content="Apylers"><meta name=keywords content="爬虫,网易云音乐,development,next-gen"><meta name=description content="最近实现了在网易云音乐搜索关键词爬取歌单内容的方法，涉及到部分对 JavaScript 的分析，稍有难度，这里作一些介绍并附上代码！"><meta property="og:description" content="最近实现了在网易云音乐搜索关键词爬取歌单内容的方法，涉及到部分对 JavaScript 的分析，稍有难度，这里作一些介绍并附上代码！"><meta property="og:type" content="article"><meta property="og:title" content="网易云音乐歌单搜索爬虫"><meta name=twitter:title content="网易云音乐歌单搜索爬虫"><meta property="og:url" content="https://cyh.me/2020/07/music-163-com-crawler/"><meta property="twitter:url" content="https://cyh.me/2020/07/music-163-com-crawler/"><meta property="og:site_name" content="幸运小站"><meta property="og:description" content="最近实现了在网易云音乐搜索关键词爬取歌单内容的方法，涉及到部分对 JavaScript 的分析，稍有难度，这里作一些介绍并附上代码！"><meta name=twitter:description content="最近实现了在网易云音乐搜索关键词爬取歌单内容的方法，涉及到部分对 JavaScript 的分析，稍有难度，这里作一些介绍并附上代码！"><meta property="og:locale" content="zh-cn"><meta property="article:published_time" content="2020-07-13T00:00:00"><meta property="article:modified_time" content="2020-07-13T00:00:00"><meta property="article:section" content="crawl"><meta property="article:tag" content="爬虫"><meta property="article:tag" content="网易云音乐"><meta name=twitter:card content="summary"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/netease-music.png"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/netease-music.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/icon/favicon.png"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/icon/favicon.png"><title>网易云音乐歌单搜索爬虫</title><link rel=icon href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/icon/favicon.png><link rel=canonical href=https://cyh.me/2020/07/music-163-com-crawler/><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.13.0/css/fontawesome.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@v3.5.7/dist/jquery.fancybox.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-dark.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/tscanlin/tocbot@4.10.0/dist/tocbot.css><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/css/style.min.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149420140-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-149420140-1');</script></head><body><div id=blog><header id=header data-behavior=4><i id=btn-open-sidebar class="fas fa-bars"></i><div class=header-title><a class=header-title-link href=/>幸运小站</a></div><a class="header-right-icon open-algolia-search" href=#search><i class="fas fa-search"></i></a></header><nav id=sidebar data-behavior=4><i id=btn-close-sidebar class="fas fa-times btn-close-sidebar"></i><div class=sidebar-container><div class=sidebar-profile><a href=/><img class=sidebar-profile-picture src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/icon/favicon.png alt=作者的图片></a><h4 class=sidebar-profile-name>Apylers</h4><h5 class=sidebar-profile-bio>This is my blog.</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=/><i class="sidebar-button-icon fas fa-home"></i><span class=sidebar-button-desc>首页</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/categories><i class="sidebar-button-icon fas fa-bookmark"></i><span class=sidebar-button-desc>分类</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/tags><i class="sidebar-button-icon fas fa-tags"></i><span class=sidebar-button-desc>标签</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/archives><i class="sidebar-button-icon fas fa-archive"></i><span class=sidebar-button-desc>归档</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/apylers target=_blank rel=noopener><i class="sidebar-button-icon fab fa-github"></i><span class=sidebar-button-desc>GitHub</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=mailto://apylers@mail.cyh.me target=_blank rel=noopener><i class="sidebar-button-icon fas fa-envelope"></i><span class=sidebar-button-desc>Email</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/#about><i class="sidebar-button-icon fas fa-question"></i><span class=sidebar-button-desc>About</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=/index.xml><i class="sidebar-button-icon fas fa-rss"></i><span class=sidebar-button-desc>RSS</span></a></li></ul><ul class=sidebar-buttons></ul></div></nav><div class="post-header-cover text-center post-header-cover--partial" style=background-image:url(https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/netease-music.png) data-behavior=4></div><div id=main data-behavior=4 class="hasCover hasCoverMetaOut"><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class="post-header main-content-wrap text-center"><h1 class=post-title itemprop=headline>网易云音乐歌单搜索爬虫</h1><div class="postShorten-meta post-meta"><time itemprop=datePublished datetime=2020-07-13T00:00:00Z>2020-07-13</time>
<span>发布在</span>
<a class=category-link href=/categories/crawl>crawl</a></div></div><div class="post-content markdown" itemprop=articleBody><div class=main-content-wrap><p>最近实现了在网易云音乐搜索关键词爬取歌单内容的方法，涉及到部分对 JavaScript 的分析，稍有难度，这里作一些介绍并附上代码！</p><div class=toc></div><h2 id=0-需求分析和结果展示>0 需求分析和结果展示</h2><p>本次爬虫的目标是在数据库中按歌单名存放歌单中歌曲的歌名、时长、歌手和专辑等信息。以下是爬取的结果展示：</p><p><a class=fancybox data-fancybox href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/scrapy-result-playlists.png data-caption></p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/scrapy-result-playlists.png alt></p></a><p><a class=fancybox data-fancybox href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/scrapy-result-songs.png data-caption></p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/scrapy-result-songs.png alt></p></a><h2 id=1-请求和加密分析>1 请求和加密分析</h2><p>先分析处理一下网易云音乐网站对关键词请求的流程。搜索关键词 <code>abc</code> 并切换到歌单搜索。在 Chrome 直接查找网页中出现的搜索结果，可以发现一页中所有的数据在 <code>https://music.163.com/weapi/cloudsearch/get/web</code> 这个接口下出现，该接口为一个 POST 请求，请求的内容经过了加密：</p><p><a class=fancybox data-fancybox href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/cloudsearch-form.png data-caption></p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/cloudsearch-form.png alt></p></a><p>搜索 <code>encSecKey</code> 发现出现在一个 <a href=https://s3.music.126.net/web/s/core_b9930d1bcbbaae89e077db91364f6418.js?b9930d1bcbbaae89e077db91364f6418>JavaScript 文件</a>中，于是加入断点分析处理过程，找到：</p><pre><code class=language-javascript>Y3x = Y3x.replace(&quot;api&quot;, &quot;weapi&quot;);
e3x.method = &quot;post&quot;;
delete e3x.query;
var bVV1x = window.asrsea(JSON.stringify(i3x), bqM3x([&quot;流泪&quot;, &quot;强&quot;]), bqM3x(TM7F.md), bqM3x([&quot;爱心&quot;, &quot;女孩&quot;, &quot;惊恐&quot;, &quot;大笑&quot;]));
e3x.data = k3x.cu4y({
    params: bVV1x.encText,
    encSecKey: bVV1x.encSecKey
})
</code></pre><p>其中 <code>Y3x</code> 为 POST 请求链接，而 <code>bVV1x</code> 则存储有所需要的 <code>params</code> 和 <code>encSecKey</code>，因此重点便放在 <code>bVV1x</code> 的生成上，也就是上图中的 <code>window.asrsea</code> 函数。这个函数接受了 4 个参数，后 3 个经过测试均为常数值不变，不用改动，第 1 个参数中的 <code>i3x</code> 如下：</p><p><a class=fancybox data-fancybox href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/cloudsearch-form-enc-i3x.png data-caption></p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/cloudsearch-form-enc-i3x.png alt></p></a><p>其中的 <code>s</code> 正是输入的关键词，<code>limit</code> 为每页显示条目数，<code>offset</code> 为跳过的条目数，显示第 <code>i</code> 页的条目则 <code>offset = (i - 1) * limit</code>，其余部分保持不变。<code>JSON.stringify</code> 则将 <code>i3x</code> 字符串化，这样一来第 1 个参数的组成也弄清楚了。接下来开始分析 <code>window.asrsea</code> 函数。找到函数原型如下：</p><pre><code class=language-javascript>function d(d, e, f, g) {
    var h = {}
      , i = a(16);
    return h.encText = b(d, g),
    h.encText = b(h.encText, i),
    h.encSecKey = c(i, e, f),
    h
}
</code></pre><p>可见其中的 <code>h</code> 即为要返回的对象。通过分析发现，变量 <code>i</code> 为一个在 <code>a-zA-Z0-9</code> 中随机生成的 16 位字符串，因此实际上该值可由人工指定；函数 <code>b</code> 是 AES 加密，<code>encText</code> 是 <code>d</code> 先后使用 <code>g</code> 和 <code>i</code> 加密后的结果；函数 <code>c</code> 是 RSA 加密，<code>encSecKey</code> 是 <code>i</code> 经过 <code>e</code> 和 <code>f</code> 加密的结果。</p><h2 id=2-实现加密>2 实现加密</h2><p>经过上述分析，我们初步理清整个加密的过程，接下来通过 Python 实现相同的加密效果。</p><h3 id=21-aes-部分>2.1 AES 部分</h3><pre><code class=language-python>import base64
from Crypto.Cipher import AES


class AESCipher:
    def __init__(self, key):
        self.key = key
        self.iv = &quot;0102030405060708&quot;  # 用来填充缺失内容，JavaScript 中已给出

    def __pad(self, text):
        &quot;&quot;&quot;填充方式，加密内容必须为 16 字节的倍数，若不足则使用 self.iv 进行填充&quot;&quot;&quot;
        text_length = len(text.encode('utf-8'))  # 计算 encode 之后的长度，以应对 non-ascii 字符
        amount_to_pad = AES.block_size - (text_length % AES.block_size)
        if amount_to_pad == 0:
            amount_to_pad = AES.block_size
        pad = chr(amount_to_pad)
        return text + pad * amount_to_pad

    def encrypt(self, raw):
        &quot;&quot;&quot;加密&quot;&quot;&quot;
        raw = self.__pad(raw)
        cipher = AES.new(self.key, AES.MODE_CBC, self.iv)
        return base64.b64encode(cipher.encrypt(raw)).decode(&quot;utf-8&quot;)
</code></pre><p>通过 <code>AESCipher(key).encrypt(text)</code> 即可获得加密后的信息。</p><h3 id=22-rsa-部分>2.2 RSA 部分</h3><pre><code class=language-python>import codecs


def RSA_encrypt(random_string, key, f):
   # 字符串逆序排列
   string = random_string[::-1]
   # 转换成 byte 类型数据
   text = bytes(string, &quot;utf-8&quot;)
   # RSA加密
   sec_key = int(codecs.encode(text, encoding=&quot;hex&quot;), 16) ** int(key, 16) % int(f, 16)
   # 返回结果
   return format(sec_key, &quot;x&quot;).zfill(256)
</code></pre><p>通过 <code>RSA_encrypt(i, e, f)</code> 即可获得加密后的信息。</p><h3 id=23-获得加密后的-post-数据>2.3 获得加密后的 POST 数据</h3><pre><code class=language-python>def get_encrypt_text(post_data):
    # 后 3 个参数
    str1 = &quot;010001&quot;
    str2 = &quot;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&quot;
    str3 = &quot;0CoJUm6Qyw8W8jud&quot;

    # 随机数 i 直接人工指定
    i = &quot;0000000000000000&quot;

    temp = AESCipher(str3).encrypt(post_data)
    encText = AESCipher(i).encrypt(temp)
    encSecKey = RSA_encrypt(i, str1, str2)

    return {&quot;params&quot;: encText, &quot;encSecKey&quot;: encSecKey}
</code></pre><p>只需传入第一个参数即可得到对应的加密后的数据。</p><h2 id=3-获取搜索结果>3 获取搜索结果</h2><pre><code class=language-python>post_data = (
    '{{&quot;hlpretag&quot;:&quot;&lt;span class=\\&quot;s-fc7\\&quot;&gt;&quot;,&quot;hlposttag&quot;:&quot;&lt;/span&gt;&quot;,&quot;s&quot;:&quot;{}&quot;,&quot;type&quot;:&quot;1000&quot;,&quot;offset&quot;:&quot;{}&quot;,'
    '&quot;total&quot;:&quot;false&quot;,&quot;limit&quot;:&quot;30&quot;,&quot;csrf_token&quot;:&quot;&quot;}}'.format(搜索条目, 页码 * 30)
)
</code></pre><h2 id=4-获取歌单信息>4 获取歌单信息</h2><p>在网易云音乐网页版，点击歌单进入后，发现只能显示前 10 首歌曲的资料：</p><p><a class=fancybox data-fancybox href=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/playlist-sample.png data-caption></p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/img/music-163-com-crawler/playlist-sample.png alt></p></a><p>这显然是不够用的，于是想办法获取歌单中的全部歌曲。经过研究，这个歌单页面中确实仅仅只有前 10 首歌的信息，于是决定想办法另辟蹊径。我想起来以前曾经用过网页版能完整播放自己的歌单，便猜测在网页版登录时能显示完整的自己的歌单。果不其然，在登录后自己的歌单中找到接口 <code>https://music.163.com/weapi/v6/playlist/detail</code>，测试发现这个接口的调用实际上并不需要登录，而加密的方法同上，只需传入 <code>post_data</code> 即可获得加密数据。</p><pre><code class=language-python>post_data = '{{&quot;id&quot;:&quot;{}&quot;,&quot;offset&quot;:&quot;0&quot;,&quot;total&quot;:&quot;true&quot;,&quot;limit&quot;:&quot;1000&quot;,&quot;n&quot;:&quot;1000&quot;,&quot;csrf_token&quot;:&quot;&quot;}}'.format(
    歌单 id
)
</code></pre><p>返回的结果中包含有整个歌单中的歌曲 id，但仍然只有前 10 首会给出详细信息，因此下一步就是获取歌曲信息。</p><h2 id=5-获取歌曲信息>5 获取歌曲信息</h2><p>在歌单中点击一首歌就进入了歌曲播放页面，可以看到歌名、歌手和专辑这 3 条信息都已经出现了，唯独时长没有出现，而且出现的 3 条信息都嵌入在 HTML 中，也不太方便获取。想到网页端播放音乐的时候底部播放栏也会显示歌曲信息，尤其是会有时间进度信息。于是尝试抓取开始播放时的请求，果然发现了接口 <code>https://music.163.com/weapi/v3/song/detail</code>，仍然是同样的加密手段。</p><pre><code class=language-python>post_data = '{{&quot;id&quot;:&quot;{0}&quot;,&quot;c&quot;:&quot;[{{\\&quot;id\\&quot;:\\&quot;{0}\\&quot;}}]&quot;,&quot;csrf_token&quot;:&quot;&quot;}}'.format(
    歌曲 id
)
</code></pre><p>返回的结果不仅给出了以毫秒为单位的时长信息，也有歌名、歌手和专辑的信息。</p><h2 id=6-scrapy-抓取>6 Scrapy 抓取</h2><p>参见 <a href=https://github.com/apylers/music163com>GitHub 源码</a></p></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">标签</span><br><a class="tag tag--primary tag--small" href=/tags/%E7%88%AC%E8%99%AB/>爬虫</a>
<a class="tag tag--primary tag--small" href=/tags/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/>网易云音乐</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/07/leetcode-167/ data-tooltip="力扣：167. 两数之和 II - 输入有序数组"><i class="fas fa-angle-left"></i><span class="text-small icon-ml">下一篇</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/04/font-minification/ data-tooltip="通过 fontTools 精简字体"><span class="text-small icon-mr">上一篇</span>
<i class="fas fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions><i class="fas fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://cyh.me/2020/07/music-163-com-crawler/"><i class="fab fa-facebook"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?url=https://cyh.me/2020/07/music-163-com-crawler/"><i class="fab fa-twitter"></i></a></li></ul></div></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2020 Apylers - All Rights Reserved.</span></footer></div><div id=bottom-bar class="post-bottom-bar bottom-down" data-behavior=4><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/07/leetcode-167/ data-tooltip="力扣：167. 两数之和 II - 输入有序数组"><i class="fas fa-angle-left"></i><span class="text-small icon-ml">下一篇</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=/2020/04/font-minification/ data-tooltip="通过 fontTools 精简字体"><span class="text-small icon-mr">上一篇</span>
<i class="fas fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions><i class="fas fa-share-alt"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://cyh.me/2020/07/music-163-com-crawler/"><i class="fab fa-facebook"></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?url=https://cyh.me/2020/07/music-163-com-crawler/"><i class="fab fa-twitter"></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=4><i id=btn-close-shareoptions class="fas fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcyh.me%2F2020%2F07%2Fmusic-163-com-crawler%2F"><i class="share-option-icon fab fa-facebook"></i><span>分享到 Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fcyh.me%2F2020%2F07%2Fmusic-163-com-crawler%2F"><i class="share-option-icon fab fa-twitter"></i><span>分享到 Twitter</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fas fa-times"></i></div><img id=about-card-picture src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/icon/favicon.png alt=作者的图片><h4 id=about-card-name>Apylers</h4><div id=about-card-bio>This is my blog.</div><div id=about-card-job><i class="fas fa-briefcase"></i><br>I'm a student!</div><div id=about-card-location><i class="fas fa-map-marker"></i><br>China</div></div></div><div id=algolia-search-modal class=modal-container><div class=modal><div class=modal-header><span class=close-button><i class="fas fa-times"></i></span><i class="search-icon fas fa-search"></i><form id=algolia-search-form><input type=text id=algolia-search-input name=search class="form-control input--large search-input" placeholder=搜索></form></div><div class=modal-body><div class="no-result text-color-light text-center">没有找到文章</div><div class=results><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2020/07/leetcode-ctci-08-03/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/LeetCode-CtCI-08-03.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2020/07/leetcode-ctci-08-03/><h3 class=media-heading>力扣：程序员面试金典 08.03. 魔术索引</h3></a><span class=media-meta><span class="media-date text-small">2020-07-31</span></span><div class="media-content font-default">在数组 nums[0&mldr;n-1] 中，有所谓的魔术索引，满足条件 nums[i] = i。给定一个有序整数数组，编写一种方法找出魔术索引，若有的话，在数组 nums 中找出一个魔术索引，如果没有，则返回 -1。若有多个魔术索引，返回索引值最小的一个。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2020/07/leetcode-167/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/LeetCode-167.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2020/07/leetcode-167/><h3 class=media-heading>力扣：167. 两数之和 II - 输入有序数组</h3></a><span class=media-meta><span class="media-date text-small">2020-07-20</span></span><div class="media-content font-default">给定一个已按照升序排列的有序数组，找到两个数使得它们相加之和等于目标数。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2020/07/music-163-com-crawler/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/netease-music.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2020/07/music-163-com-crawler/><h3 class=media-heading>网易云音乐歌单搜索爬虫</h3></a><span class=media-meta><span class="media-date text-small">2020-07-13</span></span><div class="media-content font-default">最近实现了在网易云音乐搜索关键词爬取歌单内容的方法，涉及到部分对 JavaScript 的分析，稍有难度，这里作一些介绍并附上代码！</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2020/04/font-minification/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/font.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2020/04/font-minification/><h3 class=media-heading>通过 fontTools 精简字体</h3></a><span class=media-meta><span class="media-date text-small">2020-04-02</span></span><div class="media-content font-default">建站时很多博主希望用个性化字体，能很好地美化博客界面，但是使用之后才发现，字体的体积巨大，尤其是中文字体，动不动就可能有几十 MB，在这巨大体积的压迫之下不得不选择放弃使用。但是怎么能放弃呢！！！这里就教给大家一种简单精简字体的方式——通过 fontTools。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/11/ubuntu-transmission/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/transmission.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/11/ubuntu-transmission/><h3 class=media-heading>使用 transmission 搭建 BT 种子下载站</h3></a><span class=media-meta><span class="media-date text-small">2019-11-24</span></span><div class="media-content font-default">在网上寻找资源的时候时不时可能遇到一些种子链接，必须通过 BitTorrent 等工具才能下载，但由于国内的 ip 地址较少，而且一般使用种子分享的资源体积都比较巨大，直接使用本地下载耗费很多无用的时间。我们如果自己搭建一个能长时间运行的服务器来代替我们下载，不仅不占用自己电脑的空间，还能 24h 不间断下载，节约了大量时间空间成本。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/11/ubuntu-kms/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/KMS.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/11/ubuntu-kms/><h3 class=media-heading>用 Ubuntu 搭建一个 KMS 服务器</h3></a><span class=media-meta><span class="media-date text-small">2019-11-04</span></span><div class="media-content font-default">有时候新装的 Windows 系统会需要使用到 KMS 激活，这时打开激活界面会显示 Windows 10 已使用你组织的激活服务激活。有人可能怀疑其中的安全性，为了消除这种担心，选择自己搭建一个 KMS 服务器不失为一种好的选择。废话不多说，以下开始！</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/11/ubuntu-add-startup/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/startup-script.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/11/ubuntu-add-startup/><h3 class=media-heading>在 Ubuntu 中添加开机启动项的简易方式</h3></a><span class=media-meta><span class="media-date text-small">2019-11-03</span></span><div class="media-content font-default">在使用服务器时，多次遇到需要添加开机启动项的情况，上网查了很多教程，基本上都是通过修改 rc.local 的方式来达成目的，但不知为何，有时按教程操作却不起作用。在这里介绍一种 100% 能成功的操作方式 —— 通过 crontab 实现！</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/10/nginx-upgrade/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/Nginx.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/10/nginx-upgrade/><h3 class=media-heading>Nginx 升级到最新 Stable 版本</h3></a><span class=media-meta><span class="media-date text-small">2019-10-13</span></span><div class="media-content font-default">Ubuntu 中直接安装的 Nginx 并非最新的 Stable 版本，在这里本教程参考 Nginx 官方教程 给出的方法，教大家如何升级。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/10/ubuntu-change-ssh-port/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/SSH.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/10/ubuntu-change-ssh-port/><h3 class=media-heading>Ubuntu 修改 SSH 端口</h3></a><span class=media-meta><span class="media-date text-small">2019-10-13</span></span><div class="media-content font-default">Ubuntu 服务器 SSH 默认端口是 22，在公网下容易受到攻击，在这种情况更换 SSH 端口便是十分重要的，而更换方式也是十分简单。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/10/ubuntu-auto-completion/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/command-line.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/10/ubuntu-auto-completion/><h3 class=media-heading>Ubuntu 开启输入自动补全功能</h3></a><span class=media-meta><span class="media-date text-small">2019-10-13</span></span><div class="media-content font-default">有时候不知什么原因，自己的 Ubuntu 系统或者刚重装的 VPS 没有开启自动补全， 在命令行下的输入效率便降低了很多很多，这里就告诉大家如何开启。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/10/google-bbr/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/Google-BBR.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/10/google-bbr/><h3 class=media-heading>Ubuntu 快速开启 Google BBR 方法</h3></a><span class=media-meta><span class="media-date text-small">2019-10-13</span></span><div class="media-content font-default">Google BBR 是 Google 开源的拥塞控制算法， 开启 BBR 加速的 VPS，网速甚至有可能提升好几个数量级。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/10/pip-upgrade-all/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/pip-Linux.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/10/pip-upgrade-all/><h3 class=media-heading>一条命令解决 pip 批量更新问题</h3></a><span class=media-meta><span class="media-date text-small">2019-10-01</span></span><div class="media-content font-default">在用 pip 管理包时尤其头疼的便是看到有大量更新的时候无法一键升级，这里给出用一条命令解决的方式！</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/07/windows-activate/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/Windows-activation.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/07/windows-activate/><h3 class=media-heading>激活 Windows 10</h3></a><span class=media-meta><span class="media-date text-small">2019-07-28</span></span><div class="media-content font-default">经常遇到重装 Windows 后发现自己的系统并未激活，这里提供一个简单有效的方式给大家。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/06/v2ray/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/V2Ray.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/06/v2ray/><h3 class=media-heading>V2Ray 搭建教程</h3></a><span class=media-meta><span class="media-date text-small">2019-06-30</span></span><div class="media-content font-default">自从今年 6 月 1 日开始的大规模封禁，我的 Shadowsocks 也受到了严重的影响，为了解决这一问题，我开始着手寻找一个更安全更稳定的翻墙方式，这便是 V2Ray。经历多次安装失败后，这里总结出一套完整的、不易出错的教程，内容基于 V2Ray 官方网站以及白话文教程。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/05/wordpress-forget-password/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/password.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/05/wordpress-forget-password/><h3 class=media-heading>忘记 WordPress 密码怎么办？</h3></a><span class=media-meta><span class="media-date text-small">2019-05-02</span></span><div class="media-content font-default">作为管理员，如果不小心忘记了自己的密码那将是十分尴尬的一件事，好在一般情况下通过找回密码即可解决，然而如果不巧，网站发不了邮件，那该怎么处理呢？</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/05/wordpress-email/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/Email.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/05/wordpress-email/><h3 class=media-heading>WordPress 配置发送邮件</h3></a><span class=media-meta><span class="media-date text-small">2019-05-01</span></span><div class="media-content font-default">很多人可能发现，自己建的 WordPress 站点无法发送邮件，导致无法注册或者无法找回密码，困惑不已。实际上出现这种状况的原因是 WordPress 默认使用的是 PHP 中的 mail 函数发送邮件，但我们并没有对其进行配置，因此不能正常发送邮件。不过解决的方法也很简单，我们使用一个插件，通过第三方邮件商发邮件即可。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/04/shadowsocks/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/Shadowsocks.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/04/shadowsocks/><h3 class=media-heading>Shadowsocks 脚本一键安装并开启 BBR 加速</h3></a><span class=media-meta><span class="media-date text-small">2019-04-15</span></span><div class="media-content font-default">众所周知，在国内无论是想使用 Google 搜索还是上 YouTube 看视频又或者是使用 Twitter、Facebook 等社交平台简直是难上加难，在这里，仅介绍受众最为广泛的 Shadowsocks 搭建教程。</div></div><div style=clear:both></div><hr></div><div class=media><div class=media-right><a class="link-unstyled hide-xs" href=https://cyh.me/2019/04/wordpress-website/><img class="lazyload media-image" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/cover/WordPress.png></a></div><div class=media-body><a class=link-unstyled href=https://cyh.me/2019/04/wordpress-website/><h3 class=media-heading>WordPress 建站教程：VPS + LNMP 快速建站</h3></a><span class=media-meta><span class="media-date text-small">2019-04-07</span></span><div class="media-content font-default">纯干货！本教程使用 VPS + LNMP 教你在 1~2h 内快速搭建 WordPress 网站。</div></div><div style=clear:both></div><hr></div></div></div><div class=modal-footer><p class="results-count text-medium" data-message-zero=没有找到文章 data-message-one="找到 1 篇文章" data-message-other="找到 {n} 篇文章">共 18 篇文章</p><a href=https://algolia.com target=_blank rel=noopener class="searchby-algolia text-color-light link-unstyled"><span class="searchby-algolia-text text-color-light text-small">by</span>
<img class="lazyload searchby-algolia-logo" data-src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/search/Algolia.png></a></div></div></div><div id=cover style=background-color:#333></div><script src=https://cdn.jsdelivr.net/gh/jquery/jquery@3.4.1/dist/jquery.min.js></script><script async src=https://cdn.jsdelivr.net/gh/aFarkas/lazysizes@5.2.0/lazysizes.min.js></script><script defer src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script><script>$(document).ready(function(){function fancyBox(){var arrows=true;var thumbs=null;var customSettings={closeExisting:false,loop:true,gutter:50,keyboard:true,preventCaptionOverlap:true,arrows:true,infobar:true,smallBtn:false,toolbar:false,buttons:["zoom","slideShow","thumbs","close"],idleTime:3,protect:false,modal:false,image:{preload:false},ajax:{settings:{data:{fancybox:true}}},defaultType:"image",animationEffect:"zoom",animationDuration:500,zoomOpacity:"auto",transitionEffect:"fade",transitionDuration:500,slideClass:"",baseClass:"",parentEl:"body",hideScrollbar:true,autoFocus:true,backFocus:true,trapFocus:true,fullScreen:{autoStart:false},touch:false,hash:null,media:{},slideShow:{autoStart:false,speed:3000},thumbs:{autoStart:false,hideOnClose:true,parentEl:".fancybox-container",axis:"y"},wheel:"auto",onInit:$.noop,beforeLoad:$.noop,afterLoad:$.noop,beforeShow:function(){function getScrollWidth(){var noScroll,scroll,oDiv=document.createElement("DIV");oDiv.style.cssText="position:absolute; top:-1000px; width:100px; height:100px; overflow:hidden;";noScroll=document.body.appendChild(oDiv).clientWidth;oDiv.style.overflowY="scroll";scroll=oDiv.clientWidth;document.body.removeChild(oDiv);return noScroll-scroll;}
var scrollbarWidth=getScrollWidth();var body=$("body");body.css("transition","none");body.css("width","calc(100% - "+scrollbarWidth+"px)");body.css("border-right",scrollbarWidth+"px solid white");var header=$("#header");header.css("transition","none");header.css("width","calc(100% - "+scrollbarWidth+"px)");header.addClass("compensate-for-scrollbar");var bottom=$("#bottom-bar");bottom.css("transition","none");bottom.css("width","calc(100% - 15px * 2 - "+scrollbarWidth+"px)");bottom.addClass("compensate-for-scrollbar");var toc=$(".toc");toc.css("transition","none");toc.css("right","calc((100% - 750px)/ 2 - 200px - 15px + "+scrollbarWidth+"px / 2)");},afterShow:$.noop,beforeClose:$.noop,afterClose:function(){$("body").css("border-right","");var marginElements=$("#header, #bottom-bar, body");marginElements.removeClass("compensate-for-scrollbar");marginElements.css("width","");setTimeout(function(){marginElements.css("transition","");},0);var toc=$(".toc");toc.css("right","");setTimeout(function(){toc.css("transition","");},0);},onActivate:$.noop,onDeactivate:$.noop,clickContent:function(current,event){return current.type==="image"?"zoom":false;},clickSlide:"close",clickOutside:"close",dblclickContent:false,dblclickSlide:false,dblclickOutside:false,mobile:{preventCaptionOverlap:false,idleTime:false,clickContent:"close",clickSlide:"close",dblclickContent:function(current,event){return current.type==="image"?"zoom":false;},dblclickSlide:function(current,event){return current.type==="image"?"zoom":false;}},lang:"cn",i18n:{en:{CLOSE:"Close",NEXT:"Next",PREV:"Previous",ERROR:"The requested content cannot be loaded. <br/> Please try again later.",PLAY_START:"Start slideshow",PLAY_STOP:"Pause slideshow",FULL_SCREEN:"Full screen",THUMBS:"Thumbnails",DOWNLOAD:"Download",SHARE:"Share",ZOOM:"Zoom"},de:{CLOSE:"Schliessen",NEXT:"Weiter",PREV:"Zurück",ERROR:"Die angeforderten Daten konnten nicht geladen werden. <br/> Bitte versuchen Sie es später nochmal.",PLAY_START:"Diaschau starten",PLAY_STOP:"Diaschau beenden",FULL_SCREEN:"Vollbild",THUMBS:"Vorschaubilder",DOWNLOAD:"Herunterladen",SHARE:"Teilen",ZOOM:"Maßstab"},cn:{CLOSE:"关闭",NEXT:"下一张",PREV:"上一张",ERROR:"无法加载，<br/>请稍后重试。",PLAY_START:"幻灯片放映",PLAY_STOP:"停止放映",FULL_SCREEN:"全屏",THUMBS:"缩略图",DOWNLOAD:"下载",SHARE:"分享",ZOOM:"缩放"}}};if($(window).height()>480){arrows=false;thumbs={width:70,height:70};}
$(".fancybox").fancybox(customSettings);}
fancyBox();$(window).smartresize(function(){fancyBox();});});</script><script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">MathJax.Hub.Config({messageStyle:"none",tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\[\[","\]\]"]],processEscapes:true,processEnvironments:true,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=" has-jax";}});</script><script defer src=https://cdn.jsdelivr.net/gh/tscanlin/tocbot@4.10.0/dist/tocbot.min.js></script><script>$(document).ready(function(){var id=1;$(".main-content-wrap").children("h2,h3,h4,h5").each(function(){var hyphenated="toc-"+id;$(this).attr("id",hyphenated);id++;});if($("div").hasClass("toc")){var $elm=$(".toc");var default_iniTop=606;var iniTop=$(".post").offset().top;var finTop=70;var headingsOffset=-530+default_iniTop-iniTop;locateToc();$(window).scroll(locateToc);function locateToc(){var p=$(window).scrollTop();var test=0;if($('.toc').hasClass("pushed")){test=p-606;}
if(p>iniTop-finTop){$elm.css({top:finTop+test});}else{$elm.css({top:iniTop-p+test});}}}
tocbot.init({tocSelector:".toc",contentSelector:".post-content",headingSelector:"h2, h3, h4, h5",positionFixedSelector:".toc",scrollSmoothOffset:-80,headingsOffset:headingsOffset});});</script><script>var hljsinit=function(){hljs.initHighlightingOnLoad();};</script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js onload=hljsinit()></script><script defer src=https://cdn.jsdelivr.net/npm/highlightjs-line-numbers.js@2.7.0/dist/highlightjs-line-numbers.min.js></script><script>$(document).ready(function(){hljs.configure({classPrefix:"",useBR:false});$("pre.code-highlight > code, pre > code").each(function(i,block){if(!$(this).hasClass("codeblock")){$(this).addClass("codeblock");}
hljs.highlightBlock(block);});hljs.initLineNumbersOnLoad({singleLine:true});});</script><style>td.hljs-ln-numbers{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;text-align:center;color:#ccc;border-right:1px solid #ccc;vertical-align:top;padding-right:5px}td.hljs-ln-code{padding-left:10px;padding-right:10px}table.hljs-ln tr{background:inherit}</style><script>var algoliaClient;var algoliaIndex;var algoliainit=function(){algoliaClient=algoliasearch('F2K8SP0PM5','592bb860cd3e3437145dc2a761c2c5a7');algoliaIndex=algoliaClient.initIndex('Hugo');};</script><script defer src=https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js onload=algoliainit()></script><script defer src=https://cdn.jsdelivr.net/gh/apylers/apylers.github.io@v1.0.7/js/script.min.js></script><script>window.onload=updateMinWidth;window.onresize=updateMinWidth;document.getElementById("sidebar").addEventListener("transitionend",updateMinWidth);function updateMinWidth(){var sidebar=document.getElementById("sidebar");var main=document.getElementById("main");main.style.minWidth="";var w1=getComputedStyle(main).getPropertyValue("min-width");var w2=getComputedStyle(sidebar).getPropertyValue("width");var w3=getComputedStyle(sidebar).getPropertyValue("left");main.style.minWidth=`calc(${w1} - ${w2} - ${w3})`;}</script></body></html>